<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BullorBear.ai — Bear market indicators & exit dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
  <style>
    :root {
      --bg: #0c0e12;
      --bg-panel: #141820;
      --bg-card: #1a1f2a;
      --border: #2a3140;
      --border-soft: #1e2430;
      --bear: #f97316;
      --bear-dim: #ea580c;
      --bull: #22c55e;
      --bull-dim: #16a34a;
      --warning: #eab308;
      --text: #e2e8f0;
      --text-dim: #94a3b8;
      --glow-bear: rgba(249, 115, 22, 0.15);
      --glow-bull: rgba(34, 197, 94, 0.12);
      --radius: 12px;
      --radius-sm: 8px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
      background-image: radial-gradient(ellipse 100% 50% at 50% -15%, rgba(249, 115, 22, 0.06), transparent 55%);
    }
    .app { max-width: 920px; margin: 0 auto; padding: 1.5rem 1.25rem; }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      padding: 1rem 0 1.5rem;
      border-bottom: 1px solid var(--border-soft);
      margin-bottom: 1.5rem;
    }
    .logo { font-weight: 700; font-size: 1.7rem; color: var(--bear); letter-spacing: 0.02em; }
    .tagline { font-size: 0.8rem; color: var(--text-dim); margin-top: 0.3rem; }
    .header-right { display: flex; align-items: center; gap: 0.6rem; flex-wrap: wrap; }
    .wallet-addr { font-family: 'IBM Plex Mono', monospace; font-size: 0.8rem; color: var(--bull); max-width: 140px; overflow: hidden; text-overflow: ellipsis; }
    .contract-in { width: 240px; padding: 0.5rem 0.75rem; font-family: 'IBM Plex Mono', monospace; font-size: 0.78rem; background: var(--bg-panel); border: 1px solid var(--border); color: var(--text); border-radius: var(--radius-sm); }
    .btn {
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
      padding: 0.55rem 1rem;
      border: 1px solid var(--border);
      background: var(--bg-panel);
      color: var(--text);
      cursor: pointer;
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
    }
    .btn:hover { border-color: var(--bear-dim); color: var(--bear); }
    .btn.primary { background: var(--bear-dim); border-color: var(--bear); color: #fff; }
    .btn.primary:hover { box-shadow: 0 0 20px var(--glow-bear); }
    .btn.bull { border-color: var(--bull-dim); color: var(--bull); }
    .btn.small { padding: 0.4rem 0.75rem; font-size: 0.85rem; }

    .hero {
      text-align: center;
      padding: 1.75rem 1.25rem;
      background: linear-gradient(180deg, var(--bg-card) 0%, transparent 100%);
      border: 1px solid var(--border-soft);
      border-radius: var(--radius);
      margin-bottom: 1.5rem;
    }
    .hero h1 { font-size: 1.4rem; font-weight: 700; color: var(--text); margin-bottom: 0.4rem; }
    .hero p { color: var(--text-dim); font-size: 0.92rem; }

    .gauge-card {
      background: var(--bg-card);
      border: 1px solid var(--border-soft);
      border-radius: var(--radius);
      padding: 1.25rem;
      margin-bottom: 1rem;
    }
    .gauge-card h2 { font-size: 0.9rem; font-weight: 600; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 1rem; }
    .gauge-wrap { display: flex; align-items: center; justify-content: center; gap: 1.5rem; flex-wrap: wrap; }
    .gauge {
      width: 140px; height: 140px;
      border-radius: 50%;
      background: conic-gradient(var(--bear) 0% var(--pct), var(--border) var(--pct) 100%);
      display: flex; align-items: center; justify-content: center;
    }
    .gauge-inner { width: 100px; height: 100px; border-radius: 50%; background: var(--bg-panel); display: flex; align-items: center; justify-content: center; flex-direction: column; }
    .gauge-value { font-family: 'IBM Plex Mono', monospace; font-size: 1.4rem; font-weight: 600; color: var(--text); }
    .gauge-label { font-size: 0.7rem; color: var(--text-dim); }

    .stats-row { display: flex; flex-wrap: wrap; gap: 0.75rem; margin-bottom: 1.25rem; }
    .stat-card { flex: 1; min-width: 120px; padding: 0.9rem; background: var(--bg-card); border: 1px solid var(--border-soft); border-radius: var(--radius-sm); }
    .stat-card .label { font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.25rem; }
    .stat-card .value { font-family: 'IBM Plex Mono', monospace; font-size: 1.05rem; font-weight: 600; }
    .stat-card .value.bear { color: var(--bear); }
    .stat-card .value.bull { color: var(--bull); }
    .stat-card .value.warn { color: var(--warning); }

    .alert-box {
      padding: 1rem 1.25rem;
      border-radius: var(--radius-sm);
      margin-bottom: 1rem;
      font-size: 0.95rem;
      font-weight: 500;
      display: flex; align-items: center; gap: 0.75rem;
    }
    .alert-box.exit { background: rgba(249, 115, 22, 0.12); border: 1px solid var(--bear); color: var(--bear); }
    .alert-box.hold { background: rgba(34, 197, 94, 0.1); border: 1px solid var(--bull); color: var(--bull); }
    .alert-box.warn { background: rgba(234, 179, 8, 0.1); border: 1px solid var(--warning); color: var(--warning); }

    .list-card { background: var(--bg-card); border: 1px solid var(--border-soft); border-radius: var(--radius); padding: 1rem; margin-bottom: 1rem; }
    .list-card h2 { font-size: 0.85rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem; }
    .list-item { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--border-soft); font-size: 0.88rem; }
    .list-item:last-child { border-bottom: none; }
    .list-item .val { font-family: 'IBM Plex Mono', monospace; }
    .list-item .bear { color: var(--bear); }
    .list-item .bull { color: var(--bull); }

    .message { padding: 0.75rem 1rem; border-radius: var(--radius-sm); font-size: 0.9rem; margin-bottom: 1rem; }
    .message.info { background: rgba(249, 115, 22, 0.08); border: 1px solid var(--bear); color: var(--bear); }
    .message.error { background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; color: #f87171; }
    .message.success { background: rgba(34, 197, 94, 0.1); border: 1px solid var(--bull); color: var(--bull); }

    .tabs { display: flex; gap: 0.25rem; margin-bottom: 1rem; }
    .tab { padding: 0.5rem 1rem; border-radius: var(--radius-sm); cursor: pointer; border: 1px solid var(--border); background: var(--bg-panel); color: var(--text-dim); font-weight: 500; }
    .tab.active { border-color: var(--bear); color: var(--bear); background: var(--glow-bear); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .empty-state { padding: 1.5rem; text-align: center; color: var(--text-dim); font-size: 0.9rem; }
    footer { text-align: center; padding: 1.5rem 0; font-size: 0.78rem; color: var(--text-dim); }
    .chart-placeholder { height: 200px; background: var(--bg-panel); border: 1px dashed var(--border); border-radius: var(--radius-sm); margin-bottom: 1rem; display: flex; align-items: center; justify-content: center; color: var(--text-dim); font-size: 0.9rem; }
    .faq-item { padding: 0.75rem 0; border-bottom: 1px solid var(--border-soft); }
    .faq-item:last-child { border-bottom: none; }
    .faq-q { font-weight: 600; color: var(--text); margin-bottom: 0.25rem; }
    .faq-a { font-size: 0.9rem; color: var(--text-dim); }
    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    @media (max-width: 600px) { .two-col { grid-template-columns: 1fr; } }
    .refresh-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .section-title { font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; }
    .network-bar { padding: 0.5rem 1rem; background: var(--bg-panel); border-radius: var(--radius-sm); margin-bottom: 1rem; font-size: 0.8rem; color: var(--text-dim); text-align: center; }
    .recommendation { padding: 1rem 1.25rem; border-radius: var(--radius-sm); font-size: 0.95rem; margin-bottom: 1rem; border: 1px solid var(--border-soft); }
    .recommendation.exit { border-color: var(--bear); background: var(--glow-bear); color: var(--bear); }
    .recommendation.hold { border-color: var(--bull); background: var(--glow-bull); color: var(--bull); }
    @media (max-width: 640px) {
      .app { padding: 1rem 0.75rem; }
      .logo { font-size: 1.4rem; }
      .contract-in { width: 100%; max-width: 100%; }
      .stats-row { flex-direction: column; }
      .stat-card { min-width: 100%; }
      .gauge { width: 120px; height: 120px; }
      .gauge-inner { width: 85px; height: 85px; }
    }
    .loading { opacity: 0.7; pointer-events: none; }
    .badge { display: inline-block; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.7rem; font-weight: 600; }
    .badge.bear { background: var(--glow-bear); color: var(--bear); }
    .badge.bull { background: var(--glow-bull); color: var(--bull); }
    .meta-row { display: flex; justify-content: space-between; align-items: center; padding: 0.4rem 0; font-size: 0.82rem; color: var(--text-dim); }
    .glossary dt { font-weight: 600; color: var(--text); margin-top: 0.5rem; font-size: 0.9rem; }
    .glossary dd { margin-left: 0; margin-bottom: 0.5rem; font-size: 0.88rem; color: var(--text-dim); padding-left: 1rem; }
    .link-muted { color: var(--text-dim); font-size: 0.85rem; }
    .divider { height: 1px; background: var(--border-soft); margin: 1rem 0; }
    .quick-ref-list { font-size: 0.84rem; color: var(--text-dim); line-height: 1.9; padding-left: 1.25rem; }
    .quick-ref-list li { margin-bottom: 0.25rem; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <div class="logo">BullorBear.ai</div>
        <div class="tagline">Bear market indicators & exit dashboard</div>
      </div>
      <div class="header-right">
        <span class="wallet-addr" id="walletAddr">Not connected</span>
        <input type="text" class="contract-in" id="contractAddr" placeholder="BearDet contract address" />
        <button type="button" class="btn primary" id="btnConnect">Connect</button>
        <button type="button" class="btn" id="btnDisconnect" style="display:none;">Disconnect</button>
      </div>
    </header>

    <div class="network-bar" id="networkBar">Network: —</div>
    <div class="hero">
      <h1>Exit readiness at a glance</h1>
      <p>Monitor drawdown, signals, and advisories. When the gauge crosses your threshold, consider reducing exposure.</p>
    </div>

    <div id="messageBox"></div>
    <div id="alertBox"></div>
    <div id="recommendationDetail" class="recommendation hold" style="display:none;"></div>

    <div class="refresh-row">
      <span class="section-title">Dashboard</span>
      <button type="button" class="btn small bull" id="btnRefresh">Refresh</button>
    </div>
    <div class="stats-row">
      <div class="stat-card"><div class="label">Exit readiness</div><div class="stat-card value bear" id="statReadiness">—</div></div>
      <div class="stat-card"><div class="label">Latest drawdown (bps)</div><div class="stat-card value" id="statDrawdown">—</div></div>
      <div class="stat-card"><div class="label">Threshold (bps)</div><div class="stat-card value" id="statThreshold">—</div></div>
      <div class="stat-card"><div class="label">Signals</div><div class="stat-card value" id="statSignals">—</div></div>
      <div class="stat-card"><div class="label">Advisories</div><div class="stat-card value" id="statAdvisories">—</div></div>
    </div>

    <div class="gauge-card">
      <h2>Exit readiness gauge</h2>
      <div class="gauge-wrap">
        <div class="gauge" id="gaugeEl" style="--pct: 0%">
          <div class="gauge-inner">
            <span class="gauge-value" id="gaugeValue">0%</span>
            <span class="gauge-label">readiness</span>
          </div>
        </div>
      </div>
    </div>

    <div class="tabs">
      <button type="button" class="tab active" data-tab="signals">Signals</button>
      <button type="button" class="tab" data-tab="drawdowns">Drawdowns</button>
      <button type="button" class="tab" data-tab="advisories">Advisories</button>
      <button type="button" class="tab" data-tab="config">Config</button>
    </div>

    <div id="tabSignals" class="tab-content active">
      <div class="list-card">
        <h2>Recent exit signals</h2>
        <div id="signalsList" class="empty-state">Connect and load contract to see signals.</div>
      </div>
    </div>
    <div id="tabDrawdowns" class="tab-content">
      <div class="list-card">
        <h2>Recent drawdowns</h2>
        <div id="drawdownsList" class="empty-state">Connect and load contract to see drawdowns.</div>
      </div>
    </div>
    <div id="tabAdvisories" class="tab-content">
      <div class="list-card">
        <h2>Exit advisories</h2>
        <div id="advisoriesList" class="empty-state">Connect and load contract to see advisories.</div>
      </div>
    </div>
    <div id="tabConfig" class="tab-content">
      <div class="list-card">
        <h2>Contract config</h2>
        <div id="configList" class="empty-state">Connect and load contract to see config.</div>
      </div>
    </div>

    <div class="gauge-card">
      <h2>Drawdown trend (last 10)</h2>
      <div class="chart-placeholder" id="drawdownChart">Chart: connect contract and refresh to see drawdown series.</div>
    </div>

    <div class="list-card">
      <h2>FAQ</h2>
      <div class="faq-item">
        <div class="faq-q">What is BullorBear.ai?</div>
        <div class="faq-a">A dashboard for bear market indicators and exit assistance. It reads from a BearDet contract to show drawdown, exit signals, and advisories.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">What is exit readiness?</div>
        <div class="faq-a">A 0–100% score derived from latest drawdown vs threshold. When it reaches 100%, the contract recommends considering an exit.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">How do I use it?</div>
        <div class="faq-a">Connect your wallet, paste your deployed BearDet contract address, and the dashboard will load. Refresh or reload to update.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">Is this financial advice?</div>
        <div class="faq-a">No. This is a dashboard for on-chain data only. Always do your own research before making any financial decision.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">What is BearDet?</div>
        <div class="faq-a">BearDet is an on-chain contract that records drawdowns, exit signals, and advisories. This UI reads that data to show you when conditions suggest considering an exit.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">Why does the gauge show 0%?</div>
        <div class="faq-a">Either no contract is loaded, or the contract has no drawdown snapshots yet. Deploy BearDet, have the reporter submit drawdowns, then point this dashboard at the contract.</div>
      </div>
    </div>

    <div class="list-card">
      <h2>About BullorBear.ai</h2>
      <p style="font-size:0.9rem;color:var(--text-dim);line-height:1.6;margin-bottom:0.75rem;">
        BullorBear.ai is a read-only dashboard for bear market indicators and exit assistance. It connects to your wallet to read from a deployed BearDet contract. The contract stores drawdown snapshots (peak vs current value), exit signals (when indicators cross thresholds), and exit advisories (severity-rated recommendations). This UI displays exit readiness (latest drawdown vs threshold), recent signals, drawdowns, and advisories, plus a simple drawdown trend chart. Use it to monitor conditions; never as the sole basis for financial decisions.
      </p>
      <p style="font-size:0.85rem;color:var(--text-dim);">
        Built for BearDet and TimeToExit. Not financial advice.
      </p>
    </div>

    <div class="list-card">
      <h2>How to use</h2>
      <div class="meta-row"><span>1.</span><span>Connect your Web3 wallet (e.g. MetaMask) using the Connect button.</span></div>
      <div class="meta-row"><span>2.</span><span>Paste your deployed BearDet contract address in the header input.</span></div>
      <div class="meta-row"><span>3.</span><span>The dashboard will load exit readiness, latest drawdown, threshold, signals, and advisories.</span></div>
      <div class="meta-row"><span>4.</span><span>Use the tabs to view Signals, Drawdowns, Advisories, and Config.</span></div>
      <div class="meta-row"><span>5.</span><span>Click Refresh to update data, or wait for the automatic refresh every 20 seconds.</span></div>
    </div>

    <div class="list-card">
      <h2>Data explained</h2>
      <p style="font-size:0.88rem;color:var(--text-dim);line-height:1.6;margin-bottom:0.5rem;">
        <strong>Exit readiness</strong> is (latest drawdown in basis points × 10000) ÷ threshold in bps, capped at 100%. When it reaches 100%, the contract considers the exit threshold crossed.
      </p>
      <p style="font-size:0.88rem;color:var(--text-dim);line-height:1.6;margin-bottom:0.5rem;">
        <strong>Drawdown (bps)</strong> is (peak value − current value) ÷ peak value × 10000. Each snapshot is submitted by the contract's reporter role.
      </p>
      <p style="font-size:0.88rem;color:var(--text-dim);line-height:1.6;">
        <strong>Signals</strong> are raised when an indicator (e.g. drawdown) crosses a configured threshold. <strong>Advisories</strong> are severity-rated exit recommendations posted by the reporter.
      </p>
    </div>

    <div class="list-card glossary">
      <h2>Glossary</h2>
      <dl>
        <dt>BearDet</dt>
        <dd>On-chain contract that records drawdowns, exit signals, and advisories. Used by this dashboard as the data source.</dd>
        <dt>Drawdown</dt>
        <dd>Decline from a peak value. Expressed in basis points (bps): 10000 bps = 100%.</dd>
        <dt>Exit readiness</dt>
        <dd>Percentage derived from latest drawdown vs threshold. At 100%, the contract recommends considering an exit.</dd>
        <dt>Guardian</dt>
        <dd>Contract role that can set the drawdown threshold and halt the system.</dd>
        <dt>Reporter</dt>
        <dd>Contract role that can submit drawdowns, raise signals, and post advisories.</dd>
        <dt>TimeToExit</dt>
        <dd>Python counterpart to BearDet for off-chain or backend exit logic and dashboards.</dd>
      </dl>
    </div>

    <div class="list-card">
      <h2>Disclaimer</h2>
      <p style="font-size:0.85rem;color:var(--text-dim);line-height:1.6;">
        BullorBear.ai is a dashboard that reads public on-chain data from BearDet contracts. It does not hold your funds, execute trades, or provide financial, legal, or tax advice. Exit readiness and advisories are based solely on data submitted to the contract and may be incomplete or delayed. You are solely responsible for your investment decisions. Use this tool for informational purposes only and always do your own research.
      </p>
    </div>

    <div class="list-card">
      <h2>Supported contract interface</h2>
      <p style="font-size:0.82rem;color:var(--text-dim);margin-bottom:0.5rem;">This UI calls the following BearDet view functions (read-only):</p>
      <ul style="font-size:0.82rem;color:var(--text-dim);line-height:1.8;padding-left:1.25rem;">
        <li>exitReadinessBps() — current exit readiness in basis points</li>
        <li>dashboardSummary() — snapshots, signals, advisories, latest drawdown, threshold, exit flag</li>
        <li>recentSignals(limit) — last N exit signal ids, values, blocks</li>
        <li>recentDrawdowns(limit) — last N drawdown snapshot ids, bps, blocks</li>
        <li>getAdvisoryRange(from, to) — advisories in index range</li>
        <li>getConfig() — guardian, reporter, treasury, threshold, halted, deploy block</li>
        <li>shouldExit() — whether latest drawdown is above threshold</li>
        <li>snapshotCount(), signalCount(), advisoryCount() — total counts</li>
        <li>getDrawdownSeries(n) — last n drawdown bps for charting</li>
      </ul>
    </div>

    <div class="list-card">
      <h2>Troubleshooting</h2>
      <div class="faq-item">
        <div class="faq-q">Dashboard shows "—" for all stats</div>
        <div class="faq-a">Ensure your wallet is connected and the contract address is a deployed BearDet contract on the same network as your wallet. Click Refresh after pasting the address.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">"Invalid contract or network"</div>
        <div class="faq-a">The address may be wrong, or the contract is on a different chain. Switch your wallet to the correct network and paste the contract address again.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">Exit readiness stays 0%</div>
        <div class="faq-a">The contract has no drawdown snapshots yet, or the reporter has not submitted any. Drawdowns are recorded by calling recordDrawdown on the contract.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">Chart is empty</div>
        <div class="faq-a">getDrawdownSeries(n) returns the last n drawdown bps. If there are fewer than n snapshots, the chart may be short or empty.</div>
      </div>
    </div>

    <div class="list-card">
      <h2>Risk notice</h2>
      <p style="font-size:0.85rem;color:var(--text-dim);line-height:1.6;">
        Cryptocurrency and on-chain systems involve significant risk. Past drawdowns and signals do not guarantee future performance. BearDet and this dashboard are tools for monitoring only; they do not execute trades or manage your assets. You alone are responsible for evaluating when to reduce exposure or exit positions. Never invest more than you can afford to lose. Consult a qualified professional for financial or legal advice.
      </p>
    </div>

    <div class="list-card">
      <h2>Quick reference</h2>
      <p style="font-size:0.85rem;color:var(--text-dim);line-height:1.6;margin-bottom:0.75rem;">
        BPS = basis points. 10000 bps = 100%. Threshold is set by the contract guardian. Reporter submits drawdowns (peak, current) and the contract computes drawdown bps. When drawdown bps ≥ threshold bps, exit is recommended. Advisories have severity 0–5. This dashboard auto-refreshes every 20 seconds when a contract is loaded; use Refresh for an immediate update.
      </p>
      <ul class="quick-ref-list">
        <li>Connect wallet → paste BearDet address → data loads automatically.</li>
        <li>Exit readiness 100% = latest drawdown at or above threshold.</li>
        <li>Signals tab shows last 10 exit signals (value in bps).</li>
        <li>Drawdowns tab shows last 10 snapshots with bps.</li>
        <li>Advisories tab shows last 10 advisories with severity.</li>
        <li>Config tab shows guardian, reporter, treasury, threshold, halted, deploy block.</li>
      </ul>
    </div>

    <div class="list-card">
      <h2>Browser support</h2>
      <p style="font-size:0.85rem;color:var(--text-dim);line-height:1.6;">
        This dashboard works in modern browsers with Web3 wallet support (e.g. MetaMask, WalletConnect-compatible wallets). You must have a wallet extension or mobile wallet that injects <code>window.ethereum</code>. The page uses ethers.js v6 for contract reads. No server-side component is required; all data is read directly from the blockchain via your connected wallet's RPC.
      </p>
    </div>

    <div class="list-card">
      <h2>URL parameters</h2>
      <p style="font-size:0.85rem;color:var(--text-dim);line-height:1.6;">
        You can prefill the contract address via the query string: <code>?contract=0xYourBearDetAddress</code>. Example: <code>https://yoursite.com/?contract=0x1234...abcd</code>. On load, if a contract param is present, the input is filled and the contract is loaded when the wallet is already connected.
      </p>
    </div>

    <div class="list-card">
      <h2>Data flow</h2>
      <p style="font-size:0.85rem;color:var(--text-dim);line-height:1.6;">
        Reporter calls BearDet.recordDrawdown(drawdownBps, peakValue, currentValue). When drawdownBps ≥ threshold (set by guardian), the contract emits an exit signal. Reporter can also call raiseExitSignal(indicatorId, value, threshold, labelHash) and postExitAdvisory(severity). This dashboard reads dashboardSummary(), exitReadinessBps(), recentSignals(), recentDrawdowns(), getAdvisoryRange(), getConfig(), and getDrawdownSeries() to display the gauge, stats, lists, and chart. No writes are performed by this UI.
      </p>
    </div>

    <div class="list-card">
      <h2>Integration</h2>
      <p style="font-size:0.85rem;color:var(--text-dim);line-height:1.6;">
        If you embed this page in an iframe, you can call <code>window.BullorBearRefresh()</code> to trigger a dashboard refresh, <code>window.BullorBearConnect()</code> to open the connect flow, and <code>window.BullorBearDisconnect()</code> to disconnect the wallet. The contract address is stored in <code>localStorage</code> under the key <code>BullorBear_contractAddress</code> so returning users do not need to re-enter it.
      </p>
    </div>

    <div class="list-card">
      <h2>Summary</h2>
      <p style="font-size:0.85rem;color:var(--text-dim);line-height:1.6;">
        BullorBear.ai is a read-only dashboard for BearDet contracts. It shows exit readiness, drawdown history, exit signals, and advisories to help you monitor bear market conditions and decide when to consider reducing exposure. Connect your wallet, enter your BearDet contract address, and use the tabs and refresh button to stay updated. This is not financial advice.
      </p>
    </div>

    <div class="divider"></div>
    <footer>BullorBear.ai · Bear market indicators · Not financial advice</footer>
  </div>

  <script>
    (function() {
      const BPS_DENOM = 10000;
      const REFRESH_INTERVAL_MS = 20000;
      const MAX_SIGNALS_DISPLAY = 10;
      const MAX_DRAWDOWNS_DISPLAY = 10;
      const MAX_ADVISORIES_DISPLAY = 10;
      const DRAWDOWN_SERIES_LEN = 10;
      let provider = null;
      let signer = null;
      let contract = null;
      let walletAddress = null;
      let lastSummary = null;

      const $ = (id) => document.getElementById(id);
      const showMsg = (text, type) => {
        const box = $('messageBox');
        if (!box) return;
        box.innerHTML = text ? `<div class="message ${type || 'info'}">${text}</div>` : '';
        if (text) setTimeout(() => { box.innerHTML = ''; }, 5000);
      };
      const showAlert = (html) => {
        const box = $('alertBox');
        if (box) box.innerHTML = html || '';
      };

      const abi = [
        'function exitReadinessBps() view returns (uint256)',
        'function getDrawdownStats() view returns (uint256 totalSnapshots, uint256 totalSignals, uint256 totalAdvisories, uint256 currentThresholdBps, uint256 latestDrawdownBps)',
        'function dashboardSummary() view returns (uint256 totalSnapshots, uint256 totalSignals, uint256 totalAdvisories, uint256 latestDrawdownBps, uint256 thresholdBps, bool exitRecommended, uint256 treasuryBal)',
        'function recentSignals(uint256 limit) view returns (uint256[] ids, uint256[] values, uint256[] blocks)',
        'function recentDrawdowns(uint256 limit) view returns (uint256[] ids, uint256[] bpsList, uint256[] blocks)',
        'function getConfig() view returns (address guardian, address reporter, address treasury, uint256 thresholdBps, bool halted, uint256 deployBlockNum)',
        'function getAdvisoryRange(uint256 fromIndex, uint256 toIndex) view returns (uint256[] ids, address[] authors, uint8[] severities, uint256[] atBlocks)',
        'function shouldExit() view returns (bool)',
        'function snapshotCount() view returns (uint256)',
        'function signalCount() view returns (uint256)',
        'function advisoryCount() view returns (uint256)',
        'function getDrawdownSeries(uint256 n) view returns (uint256[] bpsSeries)'
      ];

      // Default display limits (can be overridden if contract returns more)
      const DEFAULT_SIGNAL_LIMIT = 10;
      const DEFAULT_DRAWDOWN_LIMIT = 10;
      const DEFAULT_ADVISORY_LIMIT = 10;
      const GAUGE_MAX_PCT = 100;

      let refreshIntervalId = null;

      async function updateNetworkBar() {
        const bar = $('networkBar');
        if (!bar || !provider) { bar.textContent = 'Network: —'; return; }
        try {
          const net = await provider.getNetwork();
          const name = net.name && net.name !== 'unknown' ? net.name : 'Chain ID ' + net.chainId;
          bar.textContent = 'Network: ' + name;
        } catch (_) {
          bar.textContent = 'Network: —';
        }
      }

      async function connect() {
        try {
          if (!window.ethereum) {
            showMsg('Install MetaMask or another Web3 wallet.', 'error');
            return;
          }
          provider = new ethers.BrowserProvider(window.ethereum);
          const accounts = await provider.send('eth_requestAccounts', []);
          if (!accounts.length) { showMsg('No account selected.', 'error'); return; }
          signer = await provider.getSigner();
          walletAddress = accounts[0];
          $('walletAddr').textContent = walletAddress.slice(0, 6) + '…' + walletAddress.slice(-4);
          $('btnConnect').style.display = 'none';
          $('btnDisconnect').style.display = '';
          showMsg('Wallet connected.', 'success');
          await updateNetworkBar();
          await loadContractIfSet();
          startRefreshLoop();
        } catch (e) {
          showMsg(e.message || 'Connection failed.', 'error');
        }
      }

      function disconnect() {
        provider = null;
        signer = null;
        contract = null;
        walletAddress = null;
        $('walletAddr').textContent = 'Not connected';
        $('btnConnect').style.display = '';
        $('btnDisconnect').style.display = 'none';
        stopRefreshLoop();
        clearDashboard();
      }

      function startRefreshLoop() {
        stopRefreshLoop();
        refreshIntervalId = setInterval(function() {
          if (contract) refreshDashboard();
        }, REFRESH_INTERVAL_MS);
      }
      function stopRefreshLoop() {
        if (refreshIntervalId) {
          clearInterval(refreshIntervalId);
          refreshIntervalId = null;
        }
      }

      async function loadContractIfSet() {
        const addr = ($('contractAddr') && $('contractAddr').value || '').trim();
        if (!addr || !provider) return;
        try {
          contract = new ethers.Contract(addr, abi, provider);
          await refreshDashboard();
        } catch (e) {
          showMsg('Invalid contract or network.', 'error');
        }
      }

      function clearDashboard() {
        $('statReadiness').textContent = '—';
        $('statDrawdown').textContent = '—';
        $('statThreshold').textContent = '—';
        $('statSignals').textContent = '—';
        $('statAdvisories').textContent = '—';
        const gauge = $('gaugeEl');
        if (gauge) { gauge.style.setProperty('--pct', '0%'); }
        $('gaugeValue').textContent = '0%';
        showAlert('');
        $('signalsList').innerHTML = '<div class="empty-state">Connect and load contract to see signals.</div>';
        $('drawdownsList').innerHTML = '<div class="empty-state">Connect and load contract to see drawdowns.</div>';
        $('advisoriesList').innerHTML = '<div class="empty-state">Connect and load contract to see advisories.</div>';
        $('configList').innerHTML = '<div class="empty-state">Connect and load contract to see config.</div>';
        const chartEl = $('drawdownChart');
        if (chartEl) chartEl.innerHTML = 'Chart: connect contract and refresh to see drawdown series.';
        const recEl = $('recommendationDetail');
        if (recEl) recEl.style.display = 'none';
      }

      function renderSignalsFallback() {
        $('signalsList').innerHTML = '<div class="empty-state">No contract loaded. Paste BearDet address and ensure wallet is connected.</div>';
      }
      function renderDrawdownsFallback() {
        $('drawdownsList').innerHTML = '<div class="empty-state">No contract loaded. Paste BearDet address and ensure wallet is connected.</div>';
      }
      function renderAdvisoriesFallback() {
        $('advisoriesList').innerHTML = '<div class="empty-state">No contract loaded. Paste BearDet address and ensure wallet is connected.</div>';
      }
      function renderConfigFallback() {
        $('configList').innerHTML = '<div class="empty-state">No contract loaded. Paste BearDet address and ensure wallet is connected.</div>';
      }

      function getReadinessDisplay(readinessBps) {
        if (readinessBps == null) return '—';
        const pct = Math.min(100, (Number(readinessBps) * 100) / BPS_DENOM);
        return pct.toFixed(2) + '%';
      }
      function getGaugePct(readinessBps) {
        if (readinessBps == null) return 0;
        return Math.min(100, (Number(readinessBps) * 100) / BPS_DENOM);
      }
      // Optional: use getReadinessDisplay and getGaugePct when formatting stats
      function formatStat(val, suffix) {
        if (val == null || val === undefined) return '—';
        return String(val) + (suffix || '');
      }
      // End of dashboard helpers — BullorBear.ai

      function formatBps(bps) {
        if (bps == null || bps === undefined) return '—';
        return (Number(bps) / 100).toFixed(2) + '%';
      }
      function formatAddress(addr) {
        if (!addr) return '—';
        const s = String(addr);
        return s.slice(0, 6) + '…' + s.slice(-4);
      }
      function setLoading(loading) {
        document.body.classList.toggle('loading', !!loading);
      }

      async function refreshDashboard() {
        if (!contract) return;
        setLoading(true);
        try {
          const [summary, readiness, shouldExitVal] = await Promise.all([
            contract.dashboardSummary().catch(() => null),
            contract.exitReadinessBps().catch(() => null),
            contract.shouldExit().catch(() => null)
          ]);
          if (summary) {
            $('statReadiness').textContent = readiness != null ? (Number(readiness) / 100).toFixed(2) + '%' : '—';
            $('statDrawdown').textContent = summary.latestDrawdownBps != null ? String(summary.latestDrawdownBps) : '—';
            $('statThreshold').textContent = summary.thresholdBps != null ? String(summary.thresholdBps) : '—';
            $('statSignals').textContent = summary.totalSignals != null ? String(summary.totalSignals) : '—';
            $('statAdvisories').textContent = summary.totalAdvisories != null ? String(summary.totalAdvisories) : '—';
            const pct = readiness != null ? Math.min(100, (Number(readiness) * 100) / BPS_DENOM) : 0;
            const gauge = $('gaugeEl');
            if (gauge) gauge.style.setProperty('--pct', pct + '%');
            $('gaugeValue').textContent = (pct).toFixed(1) + '%';
            const recEl = $('recommendationDetail');
            if (recEl) {
              recEl.style.display = '';
              if (shouldExitVal) {
                recEl.className = 'recommendation exit';
                recEl.textContent = 'Exit recommended: latest drawdown is above your configured threshold. Consider reducing exposure or moving to stable assets. This is not financial advice.';
              } else {
                recEl.className = 'recommendation hold';
                recEl.textContent = 'Below exit threshold. Keep monitoring drawdown and exit signals.';
              }
            }
            if (shouldExitVal) {
              showAlert('<div class="alert-box exit">Exit recommended: drawdown is above threshold. Consider reducing exposure.</div>');
            } else {
              showAlert('<div class="alert-box hold">Below exit threshold. Monitor drawdown and signals.</div>');
            }
          }
          const [ids, values, blocks] = await contract.recentSignals(MAX_SIGNALS_DISPLAY).catch(() => [[], [], []]);
          const signalsList = $('signalsList');
          if (ids && ids.length > 0) {
            signalsList.innerHTML = ids.map((id, i) => `<div class="list-item"><span>Signal #${id}</span><span class="val bear">${values[i]} bps</span></div>`).join('');
          } else {
            signalsList.innerHTML = '<div class="empty-state">No signals yet.</div>';
          }
          const [dIds, dBps, dBlocks] = await contract.recentDrawdowns(MAX_DRAWDOWNS_DISPLAY).catch(() => [[], [], []]);
          const drawdownsList = $('drawdownsList');
          if (dIds && dIds.length > 0) {
            drawdownsList.innerHTML = dIds.map((id, i) => `<div class="list-item"><span>Snapshot #${id}</span><span class="val">${dBps[i]} bps</span></div>`).join('');
          } else {
            drawdownsList.innerHTML = '<div class="empty-state">No drawdowns yet.</div>';
          }
          const sigCount = await contract.signalCount().catch(() => 0);
          const advCount = await contract.advisoryCount().catch(() => 0);
          let advHtml = '<div class="empty-state">No advisories yet.</div>';
          if (Number(advCount) > 0) {
            const fromIdx = Math.max(0, Number(advCount) - MAX_ADVISORIES_DISPLAY);
            const toIdx = Number(advCount) - 1;
            const [aIds, authors, sevs, aBlocks] = await contract.getAdvisoryRange(fromIdx, toIdx).catch(() => [[], [], [], []]);
            if (aIds && aIds.length > 0) {
              advHtml = aIds.map((id, i) => `<div class="list-item"><span>#${id} severity ${sevs[i]}</span><span class="val">${String(authors[i]).slice(0, 10)}…</span></div>`).join('');
            }
          }
          $('advisoriesList').innerHTML = advHtml;
          const [guardian, reporter, treasury, threshBps, halted, deployBlock] = await contract.getConfig().catch(() => [null, null, null, null, null, null]);
          if (guardian != null) {
            $('configList').innerHTML = `
              <div class="list-item"><span>Guardian</span><span class="val">${String(guardian).slice(0, 10)}…</span></div>
              <div class="list-item"><span>Reporter</span><span class="val">${String(reporter).slice(0, 10)}…</span></div>
              <div class="list-item"><span>Treasury</span><span class="val">${String(treasury).slice(0, 10)}…</span></div>
              <div class="list-item"><span>Threshold (bps)</span><span class="val">${String(threshBps)}</span></div>
              <div class="list-item"><span>Halted</span><span class="val">${halted ? 'Yes' : 'No'}</span></div>
              <div class="list-item"><span>Deploy block</span><span class="val">${String(deployBlock)}</span></div>
            `;
          }
          const series = await contract.getDrawdownSeries(DRAWDOWN_SERIES_LEN).catch(() => []);
          const chartEl = $('drawdownChart');
          if (chartEl && series && series.length > 0) {
            const maxBps = Math.max(...series.map(Number), 1);
            chartEl.innerHTML = series.map(function(bps) {
              const pct = (Number(bps) / maxBps) * 100;
              return '<div style="flex:1;min-width:8px;height:' + (40 + pct * 0.6) + 'px;background:linear-gradient(to top, var(--bear), transparent);border-radius:2px;" title="' + bps + ' bps"></div>';
            }).join('');
            chartEl.style.display = 'flex';
            chartEl.style.alignItems = 'flex-end';
            chartEl.style.height = '120px';
            chartEl.style.gap = '4px';
          } else if (chartEl) {
            chartEl.innerHTML = 'Chart: connect contract and refresh to see drawdown series.';
            chartEl.style.display = 'flex';
          }
          lastSummary = summary;
        } catch (e) {
          showMsg(e.message || 'Failed to load dashboard.', 'error');
        } finally {
          setLoading(false);
        }
      }

      document.querySelectorAll('.tab').forEach(t => t.addEventListener('click', function() {
        document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
